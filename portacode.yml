---
  - hosts: localhost
    tasks:
    - name: "Update Packages"
      become: yes
      apt:
        name: "*"
        state: latest
        update_cache: yes
    
    - name: "Install pre-requisite packages for docker install"
      become: yes
      apt:
        name: "{{ packagesdep }}"
        force_apt_get: yes
        state: latest
        update_cache: yes
      vars:
        packagesdep:
        - apt-transport-https
        - ca-certificates
        - curl
        - git
        - gnupg2
        - software-properties-common
        - wget

    - name: "Add apt signing key for docker-ce"
      become: yes
      apt_key:
        url: https://download.docker.com/linux/debian/gpg
        state: present
    
    - name: "Add Docker official repository"
      apt_repository:
        repo: deb [arch=amd64] https://download.docker.com/linux/debian {{ ansible_distribution_release | lower}} stable
        state: present

    - name: "Install Docker-CE"
      become: yes
      apt:
        name: "docker-ce"
        state: latest
        update_cache: yes
        force_apt_get: yes

    - name: "Download go-ipfs"
      docker_container:
        name: "go-ipfs"
        image: "ipfs/go-ipfs"
        exposed_ports:
          - 4001:4001
          - 127.0.0.1:8080:8080
          - 172.0.0.1:5001:5001
        volumes:
          - /data/go-ipfs/export:/export
          - /data/go-ipfs/data:/data/ipfs

#    - name: "Find blank disks of at least 64 GiB"
#      command: echo do somewhing with {{ item }}
#      with_items: 
#        - "{{ ansible_local.unused_disks }}"
#      when:
#        - min_value <= ansible_devices[item].sectors * ansible_devices[item].sectorsize <= max_value 
#      vars:
#        min_value: '{{ user_input * 1024 * 1024 * 1024 * 64 }}'
#        max_value: '{{ user_input * 1024 * 1024 * 1024 * 8192 }}'